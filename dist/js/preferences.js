function ready(e){"loading"!=document.readyState?e():document.addEventListener("DOMContentLoaded",e)}function add_event_listeners_to_form(){btnSaveAccount.addEventListener("click",(e=>save_accounts(e))),btnSaveTemplate.addEventListener("click",(e=>save_templates(e))),btnResetTemplate.addEventListener("click",(e=>reset_templates(e))),btnAddRepo.addEventListener("click",(e=>add_repo(e))),btnShowGithub.addEventListener("click",(e=>toggle_token_fields(e,btnShowGithub.dataset.target))),btnShowJira.addEventListener("click",(e=>toggle_token_fields(e,btnShowJira.dataset.target))),btnSelectDirectory.addEventListener("click",(()=>{window.zendit.send("select-directory")})),selectRepository.addEventListener("change",(e=>update_repo_information())),btnRemoveRepository.addEventListener("click",(e=>remove_repository())),btnAddCustomField.addEventListener("click",(e=>add_custom_field())),btnRemoveCustomField.addEventListener("click",(e=>remove_custom_field())),selectCustomField.addEventListener("change",(e=>update_custom_field())),btnSaveCustomFields.addEventListener("click",(e=>save_custom_field())),window.zendit.send("get-settings",{repo:"globals",init:!0})}ready(add_event_listeners_to_form);let loadedConfigs={};function save_accounts(e){let t=e.target;"I"!=e.target.nodeName&&"SPAN"!=e.target.nodeName||(t=e.target.parentNode),t.disabled=!0;const o={repo:"globals",config:{githubToken:document.getElementById("github-api-token").value,jiraDomain:document.getElementById("jira-domain").value,jiraToken:document.getElementById("jira-api-token").value,jiraEmail:document.getElementById("jira-email").value},trigger:t.id,force_overwrite:!1};window.zendit.send("save-settings",o)}function save_templates(e){let t=e.target;"I"!=e.target.nodeName&&"SPAN"!=e.target.nodeName||(t=e.target.parentNode),t.disabled=!0;const o={repo:selectRepository.value,config:{directory:document.getElementById("tbxEditDirectory").value,prTemplate:document.getElementById("pr-template").value,commentTemplate:CKEDITOR.instances["jira-comment-template"].getData(),branchRegex:tbxBranchRegex.value},trigger:t.id,force_overwrite:!1};loadedConfigs[selectRepository.value].alias!==tbxEditRepoAlias.value&&(o.config.alias=tbxEditRepoAlias.value),window.zendit.send("save-settings",o)}function reset_templates(e){let t=e.target;if("I"!=e.target.nodeName&&"SPAN"!=e.target.nodeName||(t=e.target.parentNode),"globals"==selectRepository.value)return;delete loadedConfigs[selectRepository.value].prTemplate,delete loadedConfigs[selectRepository.value].commentTemplate,delete loadedConfigs[selectRepository.value].tbxBranchRegex,t.disabled=!0;const o={repo:selectRepository.value,config:loadedConfigs[selectRepository.value],trigger:t.id,force_overwrite:!0};window.zendit.send("save-settings",o)}function add_repo(e){let t=e.target;"I"!=e.target.nodeName&&"SPAN"!=e.target.nodeName||(t=e.target.parentNode),t.disabled=!0,t.classList.replace("btn-success","btn-light");const o=tbxRepoUrl.value.split("/"),i=o.pop(),a=o.pop(),n={repo:a+"-"+i,config:{directory:tbxDirectory.value,owner:a,repo:i,alias:tbxRepoAlias.value},trigger:t.id};tbxRepoAlias.value="",tbxDirectory.value="",tbxRepoUrl.value="",window.zendit.send("save-settings",n)}function toggle_token_fields(e,t){const o=document.getElementById(t),i=document.createElement("i");i.classList.add("fas");let a=e.target;for("I"==e.target.nodeName&&(a=e.target.parentNode),"password"==o.type?(o.type="text",i.classList.add("fa-eye-slash")):(o.type="password",i.classList.add("fa-eye"));a.lastChild;)a.removeChild(a.firstChild);a.appendChild(i)}function update_repo_information(){btnRemoveRepository.disabled="globals"===selectRepository.value,loadedConfigs[selectRepository.value],"globals"!==selectRepository.value?("alias"in loadedConfigs[selectRepository.value]&&(document.getElementById("tbxEditRepoAlias").value=loadedConfigs[selectRepository.value].alias),"directory"in loadedConfigs[selectRepository.value]&&(document.getElementById("tbxEditDirectory").value=loadedConfigs[selectRepository.value].directory)):tbxEditDirectory.value="",tbxEditRepoAlias.disabled="globals"===selectRepository.value,tbxEditDirectory.disabled="globals"===selectRepository.value,"prTemplate"in loadedConfigs[selectRepository.value]?document.getElementById("pr-template").value=loadedConfigs[selectRepository.value].prTemplate:document.getElementById("pr-template").value=loadedConfigs.globals.prTemplate,"commentTemplate"in loadedConfigs[selectRepository.value]?CKEDITOR.instances["jira-comment-template"].setData(loadedConfigs[selectRepository.value].commentTemplate):CKEDITOR.instances["jira-comment-template"].setData(loadedConfigs.globals.commentTemplate)}function remove_repository(){window.zendit.send("remove-repository",selectRepository.value)}function add_custom_field(e){const t=tbxCustomField.value,o=document.querySelector('option[value="'+t+'"]');o.parentNode.removeChild(o),selectCustomField.appendChild(o),tbxCustomField.value="",1==selectCustomField.childNodes.length&&update_custom_field()}function remove_custom_field(e){const t=selectCustomField.options[selectCustomField.selectedIndex];t.parentNode.removeChild(t),fieldList.appendChild(t)}function load_custom_field(e){}function save_custom_field(e){selectCustomField.options[selectCustomField.selectedIndex]}function update_custom_field(e){console.log(selectCustomField.value)}window.zendit.receive("settings-got",(e=>{if("globals"==e.repo&&(document.getElementById("github-api-token").value=e.config.githubToken,document.getElementById("jira-domain").value=e.config.jiraDomain,document.getElementById("jira-api-token").value=e.config.jiraToken,document.getElementById("jira-email").value=e.config.jiraEmail,e.config.alias="Global",window.zendit.send("get-fields",{jiraDomain:e.config.jiraDomain,jiraToken:e.config.jiraToken,jiraEmail:e.config.jiraEmail})),e.repo in loadedConfigs==0){const t=document.createElement("option");t.value=e.repo,t.innerText=e.config.alias,selectRepository.appendChild(t)}loadedConfigs[e.repo]=e.config,update_repo_information()})),window.zendit.receive("settings-saved",(e=>{const t=document.getElementById(e.trigger);let o=t.innerHTML;t.innerText="Done",setTimeout((()=>{t.innerHTML=o,t.disabled=!1}),1500),window.zendit.send("get-settings",{repo:e.repo})})),window.zendit.receive("directory-selected",(e=>{0==e.filepath.length?(tbxDirectory.value="",btnSelectDirectory.classList.replace("btn-primary","btn-danger")):tbxDirectory.value=e.filepath,e.eligible?(btnSelectDirectory.classList.replace("btn-danger","btn-primary"),tbxDirectory.dataset.filepath=e.filepath[e.filepath.length-1],tbxDirectory.innerText=e.filepath[e.filepath.length-1].split("/").pop()):btnSelectDirectory.classList.replace("btn-primary","btn-danger"),btnAddRepo.disabled=!e.eligible})),window.zendit.receive("reload",(()=>{delete loadedConfigs[selectRepository.value],location.reload()})),window.zendit.receive("fields-got",(e=>{e.forEach((e=>{if(!0===e.custom){const t=document.createElement("option");t.value=e.name,t.innerHTML=e.name,t.dataset.id=e.id,fieldList.appendChild(t)}}))}));