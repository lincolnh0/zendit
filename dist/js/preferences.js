function ready(e){"loading"!=document.readyState?e():document.addEventListener("DOMContentLoaded",e)}function add_event_listeners_to_form(){btnSaveAccount.addEventListener("click",(e=>save_accounts(e))),btnSaveTemplate.addEventListener("click",(e=>save_templates(e))),btnResetTemplate.addEventListener("click",(e=>reset_templates(e))),btnAddRepo.addEventListener("click",(e=>add_repo(e))),btnShowGithub.addEventListener("click",(e=>toggle_token_fields(e,btnShowGithub.dataset.target))),btnShowJira.addEventListener("click",(e=>toggle_token_fields(e,btnShowJira.dataset.target))),btnSelectDirectory.addEventListener("click",(()=>{window.zendit.send("select-directory")})),selectRepository.addEventListener("change",(e=>update_repo_information())),btnRemoveRepository.addEventListener("click",(e=>remove_repository())),btnAddCustomField.addEventListener("click",(e=>add_custom_field(e))),btnRemoveCustomField.addEventListener("click",(e=>remove_custom_field(e))),selectCustomField.addEventListener("change",(e=>update_custom_field(e))),btnSaveCustomFields.addEventListener("click",(e=>save_custom_field(e))),window.zendit.send("get-settings",{repo:"globals",init:!0})}ready(add_event_listeners_to_form);let loadedConfigs={};function save_accounts(e){let t=e.target;"I"!=e.target.nodeName&&"SPAN"!=e.target.nodeName||(t=e.target.parentNode),t.disabled=!0;const i={repo:"globals",config:{githubToken:document.getElementById("github-api-token").value,jiraDomain:document.getElementById("jira-domain").value,jiraToken:document.getElementById("jira-api-token").value,jiraEmail:document.getElementById("jira-email").value},trigger:t.id,force_overwrite:!1};window.zendit.send("save-settings",i)}function save_templates(e){let t=e.target;"I"!=e.target.nodeName&&"SPAN"!=e.target.nodeName||(t=e.target.parentNode),t.disabled=!0;const i={repo:selectRepository.value,config:{directory:document.getElementById("tbxEditDirectory").value,reviewer:document.getElementById("tbxRepoReviewer").value,prTemplate:document.getElementById("pr-template").value,commentTemplate:CKEDITOR.instances["jira-comment-template"].getData()},trigger:t.id,force_overwrite:!1};loadedConfigs[selectRepository.value].alias!==tbxEditRepoAlias.value&&(i.config.alias=tbxEditRepoAlias.value),window.zendit.send("save-settings",i)}function reset_templates(e){let t=e.target;if("I"!=e.target.nodeName&&"SPAN"!=e.target.nodeName||(t=e.target.parentNode),"globals"==selectRepository.value)return;delete loadedConfigs[selectRepository.value].prTemplate,delete loadedConfigs[selectRepository.value].commentTemplate,delete loadedConfigs[selectRepository.value].reviewer,t.disabled=!0;const i={repo:selectRepository.value,config:loadedConfigs[selectRepository.value],trigger:t.id,force_overwrite:!0};window.zendit.send("save-settings",i)}function add_repo(e){let t=e.target;"I"!=e.target.nodeName&&"SPAN"!=e.target.nodeName||(t=e.target.parentNode),t.disabled=!0,t.classList.replace("btn-success","btn-light");const i=tbxRepoUrl.value.split("/"),o=i.pop(),l=i.pop(),a={repo:l+"-"+o,config:{directory:tbxDirectory.value,owner:l,repo:o,alias:tbxRepoAlias.value},trigger:t.id};tbxRepoAlias.value="",tbxDirectory.value="",tbxRepoUrl.value="",window.zendit.send("save-settings",a)}function toggle_token_fields(e,t){const i=document.getElementById(t),o=document.createElement("i");o.classList.add("fas");let l=e.target;for("I"==e.target.nodeName&&(l=e.target.parentNode),"password"==i.type?(i.type="text",o.classList.add("fa-eye-slash")):(i.type="password",o.classList.add("fa-eye"));l.lastChild;)l.removeChild(l.firstChild);l.appendChild(o)}function update_repo_information(){if(btnRemoveRepository.disabled="globals"===selectRepository.value,"globals"!==selectRepository.value){"alias"in loadedConfigs[selectRepository.value]&&(document.getElementById("tbxEditRepoAlias").value=loadedConfigs[selectRepository.value].alias),"directory"in loadedConfigs[selectRepository.value]&&(document.getElementById("tbxEditDirectory").value=loadedConfigs[selectRepository.value].directory);for(;githubUsers.firstChild;)githubUsers.removeChild(githubUsers.lastChild),tbxRepoReviewer.value="";window.zendit.send("get-github-users",{githubToken:loadedConfigs.globals.githubToken,owner:loadedConfigs[selectRepository.value].owner})}else tbxEditDirectory.value="";tbxRepoReviewer.disabled="globals"===selectRepository.value,tbxEditRepoAlias.disabled="globals"===selectRepository.value,tbxEditDirectory.disabled="globals"===selectRepository.value,"reviewer"in loadedConfigs[selectRepository.value]&&(document.getElementById("tbxRepoReviewer").value=loadedConfigs[selectRepository.value].reviewer),"prTemplate"in loadedConfigs[selectRepository.value]?document.getElementById("pr-template").value=loadedConfigs[selectRepository.value].prTemplate:document.getElementById("pr-template").value=loadedConfigs.globals.prTemplate,"commentTemplate"in loadedConfigs[selectRepository.value]?CKEDITOR.instances["jira-comment-template"].setData(loadedConfigs[selectRepository.value].commentTemplate):CKEDITOR.instances["jira-comment-template"].setData(loadedConfigs.globals.commentTemplate)}function remove_repository(){window.zendit.send("remove-repository",selectRepository.value)}function add_custom_field(e){const t=tbxCustomField.value,i=document.querySelector('option[value="'+t+'"]');i.parentNode.removeChild(i),selectCustomField.appendChild(i),tbxCustomField.value="",1==selectCustomField.childNodes.length&&update_custom_field()}function remove_custom_field(e){const t=selectCustomField.options[selectCustomField.selectedIndex];delete loadedConfigs.globals.fields[t.dataset.id],t.parentNode.removeChild(t),fieldList.appendChild(t)}function save_custom_field(e){if(selectCustomField.children.length<1)return;let t=e.target;"I"!=e.target.nodeName&&"SPAN"!=e.target.nodeName||(t=e.target.parentNode),t.disabled=!0;const i=selectCustomField.options[selectCustomField.selectedIndex],o={repo:"globals",config:{fields:Object.assign(loadedConfigs.globals.fields,{[i.dataset.id]:{name:i.value,content:CKEDITOR.instances["custom-field-template"].getData(),option:selectCustomFieldOptions.value}})},force_overwrite:!1,trigger:t.id};window.zendit.send("save-settings",o)}function update_custom_field(e){const t=selectCustomField.options[selectCustomField.selectedIndex];t.dataset.id in loadedConfigs.globals.fields?(CKEDITOR.instances["custom-field-template"].setData(loadedConfigs.globals.fields[t.dataset.id].content),selectCustomFieldOptions.value=loadedConfigs.globals.fields[t.dataset.id].option):CKEDITOR.instances["custom-field-template"].setData("")}window.zendit.receive("settings-got",(e=>{if("globals"==e.repo&&(document.getElementById("github-api-token").value=e.config.githubToken,document.getElementById("jira-domain").value=e.config.jiraDomain,document.getElementById("jira-api-token").value=e.config.jiraToken,document.getElementById("jira-email").value=e.config.jiraEmail,"fields"in e.config||(e.config.fields={}),e.config.alias="Global",window.zendit.send("get-fields",{jiraDomain:e.config.jiraDomain,jiraToken:e.config.jiraToken,jiraEmail:e.config.jiraEmail})),e.repo in loadedConfigs==0){const t=document.createElement("option");t.value=e.repo,t.innerText=e.config.alias,selectRepository.appendChild(t)}loadedConfigs[e.repo]=e.config,update_repo_information()})),window.zendit.receive("settings-saved",(e=>{const t=document.getElementById(e.trigger);let i=t.innerHTML;t.innerText="Done",setTimeout((()=>{t.innerHTML=i,t.disabled=!1}),1500),window.zendit.send("get-settings",{repo:e.repo})})),window.zendit.receive("directory-selected",(e=>{0==e.filepath.length?(tbxDirectory.value="",btnSelectDirectory.classList.replace("btn-primary","btn-danger")):tbxDirectory.value=e.filepath,e.eligible?(btnSelectDirectory.classList.replace("btn-danger","btn-primary"),tbxDirectory.dataset.filepath=e.filepath[e.filepath.length-1],tbxDirectory.innerText=e.filepath[e.filepath.length-1].split("/").pop()):btnSelectDirectory.classList.replace("btn-primary","btn-danger"),btnAddRepo.disabled=!e.eligible})),window.zendit.receive("reload",(()=>{delete loadedConfigs[selectRepository.value],location.reload()})),window.zendit.receive("fields-got",(e=>{0!==selectCustomField.childNodes.length&&0!==fieldList.childNodes.length||e.forEach((e=>{if(!0===e.custom&&"string"==e.schema.type){const t=document.createElement("option");t.value=e.name,t.innerHTML=e.name,t.dataset.id=e.id,e.id in loadedConfigs.globals.fields?(selectCustomField.appendChild(t),update_custom_field()):fieldList.appendChild(t)}}))})),window.zendit.receive("github-users-got",(e=>{for(;githubUsers.firstChild;)githubUsers.removeChild(githubUsers.lastChild);e.data.forEach((e=>{githubUserOption=document.createElement("option"),githubUserOption.value=e.login,githubUsers.appendChild(githubUserOption)}))}));